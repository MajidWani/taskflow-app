<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow - Personal Task Manager</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            --warning-gradient: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            --danger-gradient: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
            --light-bg: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            --dark-bg: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light-bg);
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        body.dark {
            background: var(--dark-bg);
            color: #f1f5f9;
        }

        body.auth-mode {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            min-height: 100vh;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* Animated Background Elements */
        body.auth-mode::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
            animation: backgroundFloat 20s ease-in-out infinite;
        }

        body.auth-mode::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.02) 50%, transparent 70%),
                linear-gradient(-45deg, transparent 30%, rgba(255, 255, 255, 0.02) 50%, transparent 70%);
            animation: backgroundRotate 30s linear infinite;
            pointer-events: none;
        }

        /* Floating Shapes */
        .floating-shape {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            animation: float 15s ease-in-out infinite;
            pointer-events: none;
        }

        .floating-shape:nth-child(1) {
            width: 80px;
            height: 80px;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .floating-shape:nth-child(2) {
            width: 120px;
            height: 120px;
            top: 20%;
            right: 15%;
            animation-delay: -5s;
        }

        .floating-shape:nth-child(3) {
            width: 60px;
            height: 60px;
            bottom: 20%;
            left: 20%;
            animation-delay: -10s;
        }

        .floating-shape:nth-child(4) {
            width: 100px;
            height: 100px;
            bottom: 15%;
            right: 10%;
            animation-delay: -7s;
        }

        .floating-shape:nth-child(5) {
            width: 40px;
            height: 40px;
            top: 50%;
            left: 5%;
            animation-delay: -3s;
        }

        .floating-shape:nth-child(6) {
            width: 90px;
            height: 90px;
            top: 60%;
            right: 5%;
            animation-delay: -12s;
        }

        @keyframes backgroundFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(1deg); }
            66% { transform: translateY(10px) rotate(-1deg); }
        }

        @keyframes backgroundRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes float {
            0%, 100% { 
                transform: translateY(0px) translateX(0px) scale(1);
                opacity: 0.7;
            }
            25% { 
                transform: translateY(-20px) translateX(10px) scale(1.1);
                opacity: 0.4;
            }
            50% { 
                transform: translateY(10px) translateX(-5px) scale(0.9);
                opacity: 0.8;
            }
            75% { 
                transform: translateY(-15px) translateX(-10px) scale(1.05);
                opacity: 0.5;
            }
        }

        .auth-container {
            width: 100%;
            max-width: 28rem;
        }

        body.app-mode {
            padding: 0;
            min-height: 100vh;
        }

        /* Dark mode styles */
        .dark .bg-white { background-color: #1e293b !important; }
        .dark .text-gray-900 { color: #f1f5f9 !important; }
        .dark .text-gray-700 { color: #cbd5e1 !important; }
        .dark .text-gray-600 { color: #94a3b8 !important; }
        .dark .text-gray-500 { color: #64748b !important; }
        .dark .border-gray-200 { border-color: #334155 !important; }
        .dark .border-gray-300 { border-color: #475569 !important; }
        .dark .bg-gray-50 { background-color: #0f172a !important; }
        .dark .bg-gray-100 { background-color: #1e293b !important; }
        .dark .bg-gray-200 { background-color: #334155 !important; }

        /* Custom animations */
        @keyframes progressFill {
            from { stroke-dashoffset: 490; }
            to { stroke-dashoffset: var(--progress-offset); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0, -8px, 0); }
            70% { transform: translate3d(0, -4px, 0); }
            90% { transform: translate3d(0, -2px, 0); }
        }

        .animate-slide-up {
            animation: slideUp 0.6s ease-out;
        }

        .animate-fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        .animate-bounce-gentle {
            animation: bounce 1s ease-in-out;
        }

        /* Progress ring animation */
        .progress-ring__progress {
            stroke-dasharray: 490;
            stroke-dashoffset: 490;
            transition: stroke-dashoffset 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 4px 12px rgba(102, 126, 234, 0.4));
        }

        .progress-ring__progress.animate {
            animation: progressFill 1.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        /* Hover effects */
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b;
        }

        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569;
        }

        .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Dropdown menu styles */
        .dropdown-menu {
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px) scale(0.95);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        /* Search input styles */
        .search-input {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .dark .search-input {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(71, 85, 105, 0.3);
        }

        /* Filter chips */
        .filter-chip {
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
        }

        .filter-chip:hover {
            transform: translateY(-1px);
        }

        .filter-chip.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transform: translateY(-1px);
        }

        /* Priority badges */
        .priority-high {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .priority-medium {
            background: linear-gradient(135deg, #fffbeb, #fef3c7);
            color: #d97706;
            border: 1px solid #fed7aa;
        }

        .priority-low {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            color: #16a34a;
            border: 1px solid #bbf7d0;
        }

        .dark .priority-high {
            background: rgba(220, 38, 38, 0.1);
            border-color: rgba(220, 38, 38, 0.2);
        }

        .dark .priority-medium {
            background: rgba(217, 119, 6, 0.1);
            border-color: rgba(217, 119, 6, 0.2);
        }

        .dark .priority-low {
            background: rgba(22, 163, 74, 0.1);
            border-color: rgba(22, 163, 74, 0.2);
        }

        /* Due date labels */
        .due-overdue {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .due-today {
            background: linear-gradient(135deg, #fffbeb, #fef3c7);
            color: #d97706;
            border: 1px solid #fed7aa;
        }

        .due-soon {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            color: #2563eb;
            border: 1px solid #bfdbfe;
        }

        .due-later {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            color: #64748b;
            border: 1px solid #e2e8f0;
        }

        /* Modal styles */
        .modal-overlay {
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.4);
        }

        /* Input with icons */
        .input-with-icon {
            position: relative;
        }

        .input-with-icon input {
            padding-left: 2.75rem;
        }

        .input-with-icon .icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            pointer-events: none;
        }

        .dark .input-with-icon .icon {
            color: #6b7280;
        }

        /* Auth container styles */
        .auth-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 25px 50px -12px rgba(0, 0, 0, 0.25),
                0 0 0 1px rgba(255, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
            position: relative;
            overflow: hidden;
        }

        .auth-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
        }

        .dark .auth-container {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(71, 85, 105, 0.4);
            box-shadow: 
                0 25px 50px -12px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(71, 85, 105, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Hide elements */
        .hidden {
            display: none !important;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .modal-content {
                margin: 10px;
                max-height: 95vh;
            }
        }
    </style>
</head>
<body>
    <!-- Floating Background Shapes -->
    <div class="floating-shape"></div>
    <div class="floating-shape"></div>
    <div class="floating-shape"></div>
    <div class="floating-shape"></div>
    <div class="floating-shape"></div>
    <div class="floating-shape"></div>

    <div class="flex items-center justify-center min-h-screen w-full" id="containerWrapper">
        <!-- Login Page -->
        <div id="loginPage" class="auth-container rounded-3xl shadow-2xl p-10 w-full max-w-lg relative z-10">
            <div class="text-center mb-10">
                <div class="mb-8 flex justify-center">
                    <div class="relative">
                        <div class="relative">
                            <img src="https://i.ibb.co/t0DB2j7/logo.png" alt="TaskFlow Logo" class="w-16 h-16 object-contain" onerror="this.style.display='none'; this.parentElement.innerHTML='<div class=&quot;w-16 h-16 bg-gradient-to-br from-blue-500 via-purple-500 to-indigo-600 rounded-xl flex items-center justify-center text-3xl text-white font-bold shadow-2xl&quot;>📋</div>';">
                        </div>
                        <div class="absolute -inset-1 bg-gradient-to-br from-blue-400 to-purple-600 rounded-xl blur opacity-30 animate-pulse"></div>
                    </div>
                </div>
                <div class="mb-6">
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-2">
                        Welcome to TaskFlow
                    </h2>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Sign in to continue your productivity journey</p>
                </div>
            </div>
            
            <div id="loginError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4"></div>
            <div id="loginSuccess" class="hidden bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-4"></div>
            
            <form id="loginForm" class="space-y-7">
                <div class="space-y-5">
                    <div>
                        <label for="loginEmail" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Email Address</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"></path>
                                </svg>
                            </div>
                            <input type="email" id="loginEmail" required autocomplete="email" placeholder="john.doe@example.com"
                                   class="w-full pl-12 pr-4 py-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                        </div>
                    </div>
                    
                    <div>
                        <label for="loginPassword" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Password</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                </svg>
                            </div>
                            <input type="password" id="loginPassword" required autocomplete="current-password" placeholder="Enter your password"
                                   class="w-full pl-12 pr-16 py-4 border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                            <button type="button" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 font-medium text-sm"
                                    onclick="togglePassword('loginPassword')">Show</button>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 text-white py-4 px-6 rounded-xl font-bold text-lg hover:from-blue-700 hover:via-purple-700 hover:to-indigo-700 transform hover:scale-[1.02] transition-all duration-200 shadow-xl hover:shadow-2xl" id="loginBtn">
                    <span class="btn-text">Sign In to TaskFlow</span>
                </button>
            </form>
            
            <div class="text-center mt-8">
                <a href="#" onclick="showForgotPassword()" class="inline-flex items-center text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium hover:underline transition-colors">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                    </svg>
                    Forgot your password?
                </a>
            </div>
            
            <div class="text-center mt-8 pt-6 border-t border-gray-200 dark:border-gray-600">
                <p class="text-gray-600 dark:text-gray-400 mb-3">New to TaskFlow?</p>
                <a href="#" onclick="showSignup()" class="inline-flex items-center justify-center w-full py-3 px-4 border-2 border-blue-600 dark:border-blue-400 text-blue-600 dark:text-blue-400 rounded-xl font-semibold hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                    </svg>
                    Create Your Account
                </a>
            </div>
        </div>

        <!-- Signup Page -->
        <div id="signupPage" class="auth-container rounded-3xl shadow-2xl p-10 w-full max-w-lg relative z-10 hidden">
            <div class="text-center mb-8">
                <div class="mb-6 flex justify-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center text-2xl text-white font-bold shadow-lg">
                        TF
                    </div>
                </div>
                <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">
                    Create Account
                </h1>
                <p class="text-gray-600">Join TaskFlow to boost your productivity</p>
            </div>
            
            <div id="signupError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4"></div>
            <div id="signupSuccess" class="hidden bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-4"></div>
            
            <form id="signupForm" class="space-y-6">
                <div>
                    <label for="signupName" class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                    <input type="text" id="signupName" required autocomplete="name" minlength="2"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                </div>
                
                <div>
                    <label for="signupEmail" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                    <input type="email" id="signupEmail" required autocomplete="email"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                </div>
                
                <div>
                    <label for="signupPassword" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <div class="relative">
                        <input type="password" id="signupPassword" required autocomplete="new-password" minlength="6"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"
                                onclick="togglePassword('signupPassword')">Show</button>
                    </div>
                    <div id="passwordStrength" class="mt-2 text-sm font-medium"></div>
                    <div id="passwordRequirements" class="mt-2 text-xs text-gray-500"></div>
                </div>
                
                <div>
                    <label for="confirmSignupPassword" class="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label>
                    <div class="relative">
                        <input type="password" id="confirmSignupPassword" required autocomplete="new-password" minlength="6"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"
                                onclick="togglePassword('confirmSignupPassword')">Show</button>
                    </div>
                    <div id="confirmPasswordMessage" class="mt-2 text-sm font-medium"></div>
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg" id="signupBtn">
                    <span class="btn-text">Create Account</span>
                </button>
            </form>
            
            <div class="text-center mt-6 text-gray-600 dark:text-gray-400">
                Already have an account? <a href="#" onclick="showLogin()" class="text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-semibold">Sign in here</a>
            </div>
        </div>

        <!-- Forgot Password Page -->
        <div id="forgotPasswordPage" class="auth-container rounded-3xl shadow-2xl p-10 w-full max-w-lg relative z-10 hidden">
            <div class="text-center mb-8">
                <div class="mb-6 flex justify-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center text-2xl text-white font-bold shadow-lg">
                        TF
                    </div>
                </div>
                <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">
                    Reset Password
                </h1>
                <p class="text-gray-600">Enter your email to receive a reset link</p>
            </div>
            
            <div id="forgotError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4"></div>
            <div id="forgotSuccess" class="hidden bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-4"></div>
            
            <form id="forgotPasswordForm" class="space-y-6">
                <div>
                    <label for="forgotEmail" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                    <input type="email" id="forgotEmail" required autocomplete="email"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg" id="forgotBtn">
                    <span class="btn-text">Send Reset Email</span>
                </button>
                
                <button type="button" class="w-full border border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-semibold hover:bg-gray-50 transition-all" onclick="showLogin()">
                    Back to Login
                </button>
            </form>
        </div>

        <!-- Email Verification Notice -->
        <div id="verificationPage" class="auth-container rounded-3xl shadow-2xl p-10 w-full max-w-lg relative z-10 hidden">
            <div class="text-center mb-8">
                <div class="mb-6 flex justify-center">
                    <div class="relative">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center text-2xl text-white font-bold shadow-lg">
                            TF
                        </div>
                    </div>
                </div>
                <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">
                    Check Your Email
                </h1>
                <p class="text-gray-600">We've sent you a verification link</p>
            </div>
            
            <div id="verificationError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4"></div>
            <div id="verificationSuccess" class="hidden bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mb-4"></div>
            
            <div class="bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-4 rounded-lg mb-6">
                <div class="font-semibold mb-2">📧 Check your email!</div>
                <div class="text-sm">
                    We've sent a verification link to <span id="verificationEmail" class="font-medium"></span>. 
                    Please click the link to verify your account.
                    <br><br>
                    <strong>Didn't receive it?</strong> Check your spam folder or resend below.
                </div>
            </div>
            
            <div class="space-y-4">
                <button type="button" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg" id="resendBtn" onclick="resendVerificationEmail()">
                    <span class="btn-text">Resend Verification Email</span>
                </button>
                
                <button type="button" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-700 transition-all" id="checkVerificationBtn" onclick="checkEmailVerification()">
                    <span class="btn-text">I've Verified My Email</span>
                </button>
                
                <button type="button" class="w-full border border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-semibold hover:bg-gray-50 transition-all" onclick="showLogin()">
                    Back to Login
                </button>
            </div>
        </div>

        <!-- Main App -->
        <div id="mainApp" class="hidden min-h-screen relative">
            <!-- Background decorations -->
            <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
                <div class="absolute top-20 left-10 w-64 h-64 bg-gradient-to-br from-blue-400/5 to-purple-400/5 rounded-full blur-3xl"></div>
                <div class="absolute top-40 right-20 w-48 h-48 bg-gradient-to-br from-indigo-400/5 to-pink-400/5 rounded-full blur-3xl"></div>
                <div class="absolute bottom-20 left-20 w-56 h-56 bg-gradient-to-br from-purple-400/5 to-pink-400/5 rounded-full blur-3xl"></div>
                <div class="absolute bottom-40 right-10 w-40 h-40 bg-gradient-to-br from-teal-400/5 to-blue-400/5 rounded-full blur-3xl"></div>
            </div>
            
            <!-- Header -->
            <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-40">
                <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between items-center h-14">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-sm">
                                TF
                            </div>
                            <div class="flex flex-col">
                                <span class="text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">TaskFlow</span>
                                <span class="text-xs text-gray-500 dark:text-gray-400 -mt-1">Stay Productive</span>
                            </div>
                        </div>
                        
                        <div class="flex items-center space-x-4">
                            <div class="hidden sm:block text-right">
                                <div class="text-sm font-medium text-gray-700 dark:text-gray-300">Welcome back,</div>
                                <div class="text-sm font-semibold text-blue-600 dark:text-blue-400" id="userDisplayName"></div>
                            </div>
                            
                            <!-- AI Assistant Button -->
                            <button onclick="toggleChatbot()" class="relative p-2 rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white transition-all transform hover:scale-105 shadow-lg" title="AI Task Assistant">
                                <span class="text-lg">🤖</span>
                                <div id="chatNotification" class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full hidden animate-pulse"></div>
                            </button>
                            
                            <!-- Dark Mode Toggle -->
                            <button onclick="toggleDarkMode()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                <span class="dark:hidden">🌙</span>
                                <span class="hidden dark:inline">☀️</span>
                            </button>
                            
                            <!-- Account Settings Dropdown -->
                            <div class="relative">
                                <button onclick="toggleAccountMenu()" class="flex items-center space-x-2 px-3 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors font-medium">
                                    <span>👤</span>
                                    <span>Account</span>
                                    <span class="text-xs">▼</span>
                                </button>
                                <div id="accountMenu" class="dropdown-menu absolute right-0 mt-2 w-48 bg-white dark:bg-gray-700 rounded-lg shadow-lg border border-gray-200 dark:border-gray-600 z-20">
                                    <button onclick="openAccountSettings()" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-t-lg">
                                        ⚙️ Account Settings
                                    </button>
                                    <button onclick="openChangePassword()" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600">
                                        🔒 Change Password
                                    </button>
                                    <button onclick="logout()" class="w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-b-lg">
                                        🚪 Logout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6 relative z-10">
                <!-- Progress Dashboard -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6 mb-6 animate-slide-up relative overflow-hidden">
                    <!-- Background decoration -->
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-500/10 to-purple-500/10 rounded-full -translate-y-16 translate-x-16"></div>
                    <div class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-indigo-500/10 to-pink-500/10 rounded-full translate-y-12 -translate-x-12"></div>
                    
                    <div class="relative">
                        <div class="text-center mb-6">
                            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-1">📊 Your Progress Dashboard</h2>
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Track your productivity at a glance</p>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 items-center">
                            <!-- Progress Circle -->
                            <div class="relative flex justify-center">
                                <svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 144 144">
                                    <defs>
                                        <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                            <stop offset="50%" style="stop-color:#764ba2;stop-opacity:1" />
                                            <stop offset="100%" style="stop-color:#f093fb;stop-opacity:1" />
                                        </linearGradient>
                                    </defs>
                                    <circle cx="72" cy="72" r="60" stroke="#e5e7eb" stroke-width="6" fill="none" class="dark:stroke-gray-600"/>
                                    <circle cx="72" cy="72" r="60" stroke="url(#progressGradient)" stroke-width="6" fill="none" 
                                            stroke-linecap="round" class="progress-ring__progress" id="progressRing"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent" id="progressPercentage">0%</div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400 font-medium">Complete</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Stats Cards -->
                            <div class="lg:col-span-3 grid grid-cols-1 sm:grid-cols-3 gap-4">
                                <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border border-green-200 dark:border-green-800 rounded-xl p-4 hover:scale-105 hover:shadow-lg transition-all duration-200 cursor-pointer">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-green-100 dark:bg-green-800 rounded-lg flex items-center justify-center">
                                            <span class="text-green-600 dark:text-green-400 text-lg">✅</span>
                                        </div>
                                        <div>
                                            <div class="text-sm text-green-600 dark:text-green-400 font-medium">Completed</div>
                                            <div class="text-2xl font-bold text-green-700 dark:text-green-300" id="completedCount">0</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-gradient-to-br from-yellow-50 to-amber-50 dark:from-yellow-900/20 dark:to-amber-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4 hover:scale-105 hover:shadow-lg transition-all duration-200 cursor-pointer">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-yellow-100 dark:bg-yellow-800 rounded-lg flex items-center justify-center">
                                            <span class="text-yellow-600 dark:text-yellow-400 text-lg">⏳</span>
                                        </div>
                                        <div>
                                            <div class="text-sm text-yellow-600 dark:text-yellow-400 font-medium">Pending</div>
                                            <div class="text-2xl font-bold text-yellow-700 dark:text-yellow-300" id="pendingCount">0</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4 hover:scale-105 hover:shadow-lg transition-all duration-200 cursor-pointer">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-blue-100 dark:bg-blue-800 rounded-lg flex items-center justify-center">
                                            <span class="text-blue-600 dark:text-blue-400 text-lg">📋</span>
                                        </div>
                                        <div>
                                            <div class="text-sm text-blue-600 dark:text-blue-400 font-medium">Total</div>
                                            <div class="text-2xl font-bold text-blue-700 dark:text-blue-300" id="totalCount">0</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add Task Button -->
                <div class="text-center mb-6">
                    <button onclick="openAddTaskModal()" class="bg-gradient-to-r from-green-500 via-emerald-500 to-teal-500 hover:from-green-600 hover:via-emerald-600 hover:to-teal-600 text-white px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 hover:rotate-1 transition-all duration-200 flex items-center space-x-2 mx-auto">
                        <span class="text-lg">➕</span>
                        <span>Add New Task</span>
                    </button>
                </div>

                <!-- Search and Filters Toolbar -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 mb-6">
                    <div class="flex flex-col sm:flex-row gap-4 items-center">
                        <!-- Search Bar -->
                        <div class="relative flex-1 max-w-md">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-400">🔍</span>
                            </div>
                            <input type="text" id="searchInput" placeholder="Search tasks..." 
                                   class="search-input w-full pl-10 pr-4 py-2.5 rounded-xl border-0 focus:ring-2 focus:ring-blue-500 transition-all"
                                   oninput="handleSearch()">
                        </div>
                        
                        <!-- Filter Chips -->
                        <div class="flex flex-wrap gap-2">
                            <button onclick="filterTasks('all')" class="filter-chip active px-3 py-2 rounded-full text-sm font-medium transition-all flex items-center space-x-1" data-filter="all">
                                <span>📋</span>
                                <span>All</span>
                                <span class="ml-1 bg-white/20 px-1.5 py-0.5 rounded-full text-xs" id="allCount">0</span>
                            </button>
                            <button onclick="filterTasks('pending')" class="filter-chip bg-white/60 dark:bg-gray-700/60 text-gray-700 dark:text-gray-300 px-3 py-2 rounded-full text-sm font-medium transition-all flex items-center space-x-1" data-filter="pending">
                                <span>⏳</span>
                                <span>Pending</span>
                                <span class="ml-1 bg-gray-200 dark:bg-gray-600 px-1.5 py-0.5 rounded-full text-xs" id="pendingFilterCount">0</span>
                            </button>
                            <button onclick="filterTasks('completed')" class="filter-chip bg-white/60 dark:bg-gray-700/60 text-gray-700 dark:text-gray-300 px-3 py-2 rounded-full text-sm font-medium transition-all flex items-center space-x-1" data-filter="completed">
                                <span>✅</span>
                                <span>Completed</span>
                                <span class="ml-1 bg-gray-200 dark:bg-gray-600 px-1.5 py-0.5 rounded-full text-xs" id="completedFilterCount">0</span>
                            </button>
                            <button onclick="showCalendar()" class="filter-chip bg-white/60 dark:bg-gray-700/60 text-gray-700 dark:text-gray-300 px-3 py-2 rounded-full text-sm font-medium transition-all flex items-center space-x-1">
                                <span>📅</span>
                                <span>Calendar</span>
                            </button>
                            <button onclick="clearCompletedTasks()" class="filter-chip bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 px-3 py-2 rounded-full text-sm font-medium transition-all hover:bg-red-200 dark:hover:bg-red-900/50 flex items-center space-x-1" id="clearCompletedBtn">
                                <span>🗑️</span>
                                <span class="hidden sm:inline">Clear Completed</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tasks Container -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
                    <div id="tasksList" class="space-y-4 max-h-96 overflow-y-auto custom-scrollbar"></div>
                    
                    <!-- Calendar View -->
                    <div id="calendarView" class="hidden">
                        <div class="flex justify-between items-center mb-6">
                            <button onclick="changeMonth(-1)" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">‹</button>
                            <h3 id="calendarTitle" class="text-xl font-semibold text-gray-900 dark:text-white">January 2024</h3>
                            <button onclick="changeMonth(1)" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">›</button>
                        </div>
                        <div id="calendarGrid" class="grid grid-cols-7 gap-2 mb-4"></div>
                        <div class="flex justify-center space-x-6 text-sm text-gray-600 dark:text-gray-400">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                <span>Has Tasks</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                <span>Today</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Date Tasks View -->
                    <div id="dateTasksView" class="hidden">
                        <div class="flex items-center space-x-4 mb-6">
                            <button onclick="backToCalendar()" class="px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                ← Back to Calendar
                            </button>
                            <h3 id="selectedDateTitle" class="text-xl font-semibold text-gray-900 dark:text-white">Tasks for January 1, 2024</h3>
                        </div>
                        <div id="dateTasksList" class="space-y-4 max-h-96 overflow-y-auto custom-scrollbar"></div>
                    </div>
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="text-center py-16 hidden">
                        <div class="relative mb-8">
                            <div class="w-24 h-24 mx-auto bg-gradient-to-br from-blue-100 to-purple-100 dark:from-blue-900/20 dark:to-purple-900/20 rounded-full flex items-center justify-center mb-4">
                                <div class="text-4xl animate-bounce-gentle">📝</div>
                            </div>
                            <div class="absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-br from-yellow-400 to-orange-400 rounded-full flex items-center justify-center text-white text-sm font-bold animate-pulse">
                                ✨
                            </div>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Ready to get productive?</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-6 max-w-md mx-auto">Your task list is empty. Start by adding your first task and take control of your day!</p>
                        <button onclick="openAddTaskModal()" class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white px-6 py-2 rounded-lg font-medium shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200">
                            ➕ Add Your First Task
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Account Settings Modal -->
    <div id="accountSettingsModal" class="fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4 opacity-0 invisible transition-all duration-300">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md transform scale-95 transition-transform duration-300">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold">⚙️ Account Settings</h2>
                    <button onclick="closeAccountSettings()" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30 transition-colors">
                        ✕
                    </button>
                </div>
            </div>
            
            <!-- Modal Body -->
            <form id="accountSettingsForm" class="p-6 space-y-4">
                <div id="accountError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg"></div>
                <div id="accountSuccess" class="hidden bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg"></div>
                
                <div class="input-with-icon">
                    <span class="icon">👤</span>
                    <input type="text" id="accountName" placeholder="Full Name" maxlength="50" required
                           class="w-full pl-12 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                </div>
                
                <div class="input-with-icon">
                    <span class="icon">📧</span>
                    <input type="email" id="accountEmail" placeholder="Email Address" required
                           class="w-full pl-12 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                </div>
                
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
                    <div class="text-sm text-blue-800 dark:text-blue-200">
                        <strong>📧 Email Changes:</strong> If you change your email, you'll need to verify the new address before you can sign in with it.
                    </div>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                        💾 Save Changes
                    </button>
                    <button type="button" onclick="closeAccountSettings()" class="px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4 opacity-0 invisible transition-all duration-300">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md transform scale-95 transition-transform duration-300">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-red-600 to-pink-600 text-white p-6 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold">🔒 Change Password</h2>
                    <button onclick="closeChangePassword()" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30 transition-colors">
                        ✕
                    </button>
                </div>
            </div>
            
            <!-- Modal Body -->
            <form id="changePasswordForm" class="p-6 space-y-4">
                <div id="passwordError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg"></div>
                <div id="passwordSuccess" class="hidden bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg"></div>
                
                <div>
                    <label for="currentPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Current Password</label>
                    <div class="relative">
                        <input type="password" id="currentPassword" required
                               class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 font-medium text-sm"
                                onclick="togglePassword('currentPassword')">Show</button>
                    </div>
                </div>
                
                <div>
                    <label for="newPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">New Password</label>
                    <div class="relative">
                        <input type="password" id="newPassword" required minlength="6"
                               class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 font-medium text-sm"
                                onclick="togglePassword('newPassword')">Show</button>
                    </div>
                    <div id="newPasswordStrength" class="mt-2 text-sm font-medium"></div>
                </div>
                
                <div>
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Confirm New Password</label>
                    <div class="relative">
                        <input type="password" id="confirmPassword" required minlength="6"
                               class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 font-medium text-sm"
                                onclick="togglePassword('confirmPassword')">Show</button>
                    </div>
                </div>
                
                <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
                    <div class="text-sm text-yellow-800 dark:text-yellow-200">
                        <strong>🔐 Security Note:</strong> After changing your password, you'll be signed out and need to sign in again with your new password.
                    </div>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-red-600 to-pink-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-red-700 hover:to-pink-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                        🔒 Change Password
                    </button>
                    <button type="button" onclick="closeChangePassword()" class="px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- AI Chatbot Modal -->
    <div id="chatbotModal" class="fixed bottom-4 right-4 w-96 max-w-[calc(100vw-2rem)] bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 transform translate-y-full opacity-0 transition-all duration-300 z-50">
        <!-- Chat Header -->
        <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4 rounded-t-2xl">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                        <span class="text-lg">🤖</span>
                    </div>
                    <div>
                        <h3 class="font-semibold">AI Task Assistant</h3>
                        <p class="text-xs opacity-90">Your productivity companion</p>
                    </div>
                </div>
                <button onclick="toggleChatbot()" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30 transition-colors">
                    ✕
                </button>
            </div>
        </div>
        
        <!-- Chat Messages -->
        <div id="chatMessages" class="h-80 overflow-y-auto p-4 space-y-3 custom-scrollbar">
            <div class="flex items-start space-x-3">
                <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white text-sm">
                    🤖
                </div>
                <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-3 max-w-xs">
                    <p class="text-sm text-gray-800 dark:text-gray-200">
                        Hi! I'm your AI Task Assistant. I can help you:
                        <br>• Track your task progress
                        <br>• Remind you about deadlines
                        <br>• Suggest productivity tips
                        <br>• Analyze your task patterns
                        <br><br>What would you like to know about your tasks?
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Chat Input -->
        <div class="p-4 border-t border-gray-200 dark:border-gray-700">
            <div class="flex space-x-2">
                <input type="text" id="chatInput" placeholder="Ask me about your tasks..." 
                       class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm"
                       onkeypress="handleChatKeyPress(event)">
                <button onclick="sendChatMessage()" class="px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all font-medium text-sm">
                    Send
                </button>
            </div>
            <div class="flex flex-wrap gap-2 mt-3">
                <button onclick="sendQuickMessage('How many tasks do I have?')" class="px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-xs hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                    📊 Task Summary
                </button>
                <button onclick="sendQuickMessage('What tasks are due today?')" class="px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-xs hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                    📅 Due Today
                </button>
                <button onclick="sendQuickMessage('Give me productivity tips')" class="px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-xs hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                    💡 Tips
                </button>
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div id="addTaskModal" class="fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4 opacity-0 invisible transition-all duration-300">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md transform scale-95 transition-transform duration-300">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold">✨ Add New Task</h2>
                    <button onclick="closeAddTaskModal()" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30 transition-colors">
                        ✕
                    </button>
                </div>
            </div>
            
            <!-- Modal Body -->
            <form id="modalTaskForm" class="p-6 space-y-4">
                <div class="input-with-icon">
                    <span class="icon">📝</span>
                    <input type="text" id="modalTaskName" placeholder="Enter your task title..." maxlength="100" required
                           class="w-full pl-12 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                </div>
                
                <div>
                    <textarea id="modalTaskDescription" placeholder="Add a detailed description (optional)..." maxlength="500" rows="3"
                              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <select id="modalTaskPriority" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            <option value="low">🟢 Low Priority</option>
                            <option value="medium" selected>🟡 Medium Priority</option>
                            <option value="high">🔴 High Priority</option>
                        </select>
                    </div>
                    
                    <div class="input-with-icon">
                        <span class="icon">📅</span>
                        <input type="date" id="modalTaskDueDate" 
                               class="w-full pl-12 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    </div>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                        ✅ Add Task
                    </button>
                    <button type="button" onclick="closeAddTaskModal()" class="px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // 🔥 FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyCvDSt9HnNH_3dPOtN90e6_0io9VgwgEck",
            authDomain: "taskflow-ebc4c.firebaseapp.com",
            projectId: "taskflow-ebc4c",
            storageBucket: "taskflow-ebc4c.firebasestorage.app",
            messagingSenderId: "172525838982",
            appId: "1:172525838982:web:e119eaba713848ca482707",
            measurementId: "G-DD2547X13J"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // 📦 LOCALSTORAGE TASK MANAGEMENT
        class TaskManager {
            constructor() {
                this.storageKey = 'taskflow_tasks';
            }

            generateId() {
                return 'task_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }

            getTasks() {
                try {
                    const tasks = localStorage.getItem(this.storageKey);
                    return tasks ? JSON.parse(tasks) : [];
                } catch (error) {
                    console.error('Error loading tasks from localStorage:', error);
                    return [];
                }
            }

            saveTasks(tasks) {
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(tasks));
                    console.log('✅ Tasks saved to localStorage:', tasks.length, 'tasks');
                } catch (error) {
                    console.error('❌ Error saving tasks to localStorage:', error);
                }
            }

            addTask(taskData) {
                const tasks = this.getTasks();
                const newTask = {
                    id: this.generateId(),
                    title: taskData.title.trim(),
                    description: taskData.description ? taskData.description.trim() : '',
                    priority: taskData.priority || 'medium',
                    dueDate: taskData.dueDate || null,
                    completed: false,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                tasks.unshift(newTask);
                this.saveTasks(tasks);
                console.log('✅ Task added:', newTask);
                return newTask;
            }

            updateTask(taskId, updates) {
                const tasks = this.getTasks();
                const taskIndex = tasks.findIndex(task => task.id === taskId);
                
                if (taskIndex !== -1) {
                    tasks[taskIndex] = {
                        ...tasks[taskIndex],
                        ...updates,
                        updatedAt: new Date().toISOString()
                    };
                    this.saveTasks(tasks);
                    console.log('✅ Task updated:', tasks[taskIndex]);
                    return tasks[taskIndex];
                }
                
                console.warn('⚠️ Task not found for update:', taskId);
                return null;
            }

            deleteTask(taskId) {
                const tasks = this.getTasks();
                const filteredTasks = tasks.filter(task => task.id !== taskId);
                
                if (filteredTasks.length !== tasks.length) {
                    this.saveTasks(filteredTasks);
                    console.log('✅ Task deleted:', taskId);
                    return true;
                }
                
                console.warn('⚠️ Task not found for deletion:', taskId);
                return false;
            }

            toggleTask(taskId) {
                const tasks = this.getTasks();
                const task = tasks.find(task => task.id === taskId);
                
                if (task) {
                    const updatedTask = this.updateTask(taskId, { 
                        completed: !task.completed 
                    });
                    return updatedTask;
                }
                
                return null;
            }

            getFilteredTasks(filter = 'all') {
                const tasks = this.getTasks();
                
                switch (filter) {
                    case 'pending':
                        return tasks.filter(task => !task.completed);
                    case 'completed':
                        return tasks.filter(task => task.completed);
                    default:
                        return tasks;
                }
            }

            clearCompletedTasks() {
                const tasks = this.getTasks();
                const pendingTasks = tasks.filter(task => !task.completed);
                const completedCount = tasks.length - pendingTasks.length;
                
                if (completedCount > 0) {
                    this.saveTasks(pendingTasks);
                    console.log(`🗑️ Cleared ${completedCount} completed tasks`);
                    return completedCount;
                }
                
                return 0;
            }
        }

        // Global variables
        let currentUser = null;
        let currentFilter = 'all';
        let currentView = 'tasks';
        let currentCalendarDate = new Date();
        let selectedDate = null;
        let searchQuery = '';
        let chatbotOpen = false;
        let reminderInterval = null;
        const taskManager = new TaskManager();

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 TaskFlow initialized');
            
            // Initialize dark mode
            initializeDarkMode();
            
            // Listen for authentication state changes
            auth.onAuthStateChanged(function(user) {
                console.log('🔄 Auth state changed:', user ? 'User signed in' : 'User signed out');
                
                if (user) {
                    currentUser = user;
                    console.log('👤 User details:', {
                        uid: user.uid,
                        email: user.email,
                        emailVerified: user.emailVerified,
                        displayName: user.displayName
                    });
                    
                    if (user.emailVerified) {
                        showMainApp();
                    } else {
                        showEmailVerification();
                    }
                } else {
                    currentUser = null;
                    showLogin();
                }
            });

            // Add event listeners
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('signupForm').addEventListener('submit', handleSignup);
            document.getElementById('forgotPasswordForm').addEventListener('submit', handleForgotPassword);
            document.getElementById('modalTaskForm').addEventListener('submit', handleModalTaskSubmit);
            document.getElementById('signupPassword').addEventListener('input', checkPasswordStrength);
            document.getElementById('confirmSignupPassword').addEventListener('input', checkPasswordMatch);
            document.getElementById('accountSettingsForm').addEventListener('submit', handleAccountSettings);
            document.getElementById('changePasswordForm').addEventListener('submit', handleChangePassword);
            document.getElementById('newPassword').addEventListener('input', checkNewPasswordStrength);
            
            // Modal overlay click to close
            document.getElementById('addTaskModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAddTaskModal();
                }
            });
            
            // Escape key to close modal
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const modal = document.getElementById('addTaskModal');
                    if (!modal.classList.contains('opacity-0')) {
                        closeAddTaskModal();
                    }
                }
            });
        });

        // 🌙 DARK MODE FUNCTIONS
        function initializeDarkMode() {
            const isDark = localStorage.getItem('darkMode') === 'true';
            if (isDark) {
                document.body.classList.add('dark');
            }
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark');
            const isDark = document.body.classList.contains('dark');
            localStorage.setItem('darkMode', isDark);
        }

        // 🔍 SEARCH FUNCTION
        function handleSearch() {
            searchQuery = document.getElementById('searchInput').value.toLowerCase();
            loadTasks();
        }

        // 🔑 AUTHENTICATION FUNCTIONS
        async function handleLogin(e) {
            e.preventDefault();
            console.log('🔑 Login attempt started');
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('loginBtn');
            
            if (!email || !password) {
                showError('loginError', 'Please fill in all fields.');
                return;
            }
            
            if (!isValidEmail(email)) {
                showError('loginError', 'Please enter a valid email address.');
                return;
            }
            
            setButtonLoading(loginBtn, true);
            clearMessages('login');
            
            try {
                console.log('🔄 Attempting to sign in user:', email);
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                console.log('✅ Sign in successful:', user.uid);
                
                if (!user.emailVerified) {
                    console.log('⚠️ Email not verified');
                    showError('loginError', 'Please verify your email before signing in. Check your inbox for the verification link.');
                    setButtonLoading(loginBtn, false);
                    return;
                }
                
                showSuccess('loginSuccess', 'Login successful! Welcome back.');
                console.log('🎉 Login completed successfully');
                
            } catch (error) {
                console.error('❌ Login error:', error);
                handleAuthError(error, 'loginError');
            } finally {
                setButtonLoading(loginBtn, false);
            }
        }

        async function handleSignup(e) {
            e.preventDefault();
            console.log('📝 Signup attempt started');
            
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmSignupPassword').value;
            const signupBtn = document.getElementById('signupBtn');
            
            if (!name || !email || !password || !confirmPassword) {
                showError('signupError', 'Please fill in all fields.');
                return;
            }
            
            if (name.length < 2) {
                showError('signupError', 'Name must be at least 2 characters long.');
                return;
            }
            
            if (!isValidEmail(email)) {
                showError('signupError', 'Please enter a valid email address.');
                return;
            }
            
            if (password.length < 6) {
                showError('signupError', 'Password must be at least 6 characters long.');
                return;
            }
            
            if (password !== confirmPassword) {
                showError('signupError', 'Passwords do not match. Please try again.');
                return;
            }
            
            setButtonLoading(signupBtn, true);
            clearMessages('signup');
            
            try {
                console.log('🔄 Creating user account:', email);
                
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                console.log('✅ User account created:', user.uid);
                
                await user.updateProfile({
                    displayName: name
                });
                console.log('✅ User profile updated with name');
                
                await user.sendEmailVerification({
                    url: 'https://taskflow.my.canva.site',
                    handleCodeInApp: false
                });
                console.log('✅ Verification email sent');
                
                try {
                    await db.collection('users').doc(user.uid).set({
                        name: name,
                        email: email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        emailVerified: false
                    });
                    console.log('✅ User data saved to Firestore');
                } catch (firestoreError) {
                    console.warn('⚠️ Failed to save to Firestore:', firestoreError);
                }
                
                showSuccess('signupSuccess', 'Account created successfully! Please check your email for verification.');
                console.log('🎉 Signup completed successfully');
                
                setTimeout(() => {
                    showEmailVerification();
                }, 2000);
                
            } catch (error) {
                console.error('❌ Signup error:', error);
                handleAuthError(error, 'signupError');
            } finally {
                setButtonLoading(signupBtn, false);
            }
        }

        async function handleForgotPassword(e) {
            e.preventDefault();
            console.log('🔄 Password reset attempt started');
            
            const email = document.getElementById('forgotEmail').value.trim();
            const forgotBtn = document.getElementById('forgotBtn');
            
            if (!email) {
                showError('forgotError', 'Please enter your email address.');
                return;
            }
            
            if (!isValidEmail(email)) {
                showError('forgotError', 'Please enter a valid email address.');
                return;
            }
            
            setButtonLoading(forgotBtn, true);
            clearMessages('forgot');
            
            try {
                console.log('🔄 Sending password reset email to:', email);
                await auth.sendPasswordResetEmail(email);
                
                showSuccess('forgotSuccess', 'Password reset email sent! Check your inbox for instructions.');
                console.log('✅ Password reset email sent successfully');
                
                document.getElementById('forgotPasswordForm').reset();
                
            } catch (error) {
                console.error('❌ Password reset error:', error);
                handleAuthError(error, 'forgotError');
            } finally {
                setButtonLoading(forgotBtn, false);
            }
        }

        async function resendVerificationEmail() {
            console.log('🔄 Resending verification email');
            
            if (!auth.currentUser) {
                showError('verificationError', 'No user signed in. Please sign up again.');
                return;
            }
            
            const resendBtn = document.getElementById('resendBtn');
            setButtonLoading(resendBtn, true);
            clearMessages('verification');
            
            try {
                await auth.currentUser.reload();
                
                if (auth.currentUser.emailVerified) {
                    showSuccess('verificationSuccess', 'Email already verified! Redirecting to app...');
                    setTimeout(() => {
                        showMainApp();
                    }, 2000);
                    return;
                }
                
                await auth.currentUser.sendEmailVerification({
                    url: 'https://taskflow.my.canva.site',
                    handleCodeInApp: false
                });
                
                showSuccess('verificationSuccess', 'Verification email sent! Check your inbox and spam folder.');
                console.log('✅ Verification email resent successfully');
                
            } catch (error) {
                console.error('❌ Resend verification error:', error);
                
                if (error.code === 'auth/too-many-requests') {
                    showError('verificationError', 'Too many requests. Please wait a few minutes before trying again.');
                } else if (error.code === 'auth/user-token-expired') {
                    showError('verificationError', 'Session expired. Please sign up again.');
                    setTimeout(() => {
                        showSignup();
                    }, 3000);
                } else {
                    handleAuthError(error, 'verificationError');
                }
            } finally {
                setButtonLoading(resendBtn, false);
            }
        }

        async function checkEmailVerification() {
            console.log('🔄 Checking email verification status');
            
            if (!auth.currentUser) {
                showError('verificationError', 'No user signed in. Please sign up again.');
                return;
            }
            
            const checkBtn = document.getElementById('checkVerificationBtn');
            setButtonLoading(checkBtn, true);
            clearMessages('verification');
            
            try {
                await auth.currentUser.reload();
                
                if (auth.currentUser.emailVerified) {
                    showSuccess('verificationSuccess', 'Email verified successfully! Welcome to TaskFlow!');
                    console.log('✅ Email verification confirmed');
                    
                    setTimeout(() => {
                        showMainApp();
                    }, 2000);
                } else {
                    showError('verificationError', 'Email not yet verified. Please check your inbox and click the verification link, then try again.');
                }
                
            } catch (error) {
                console.error('❌ Check verification error:', error);
                showError('verificationError', 'Failed to check verification status. Please try again.');
            } finally {
                setButtonLoading(checkBtn, false);
            }
        }

        async function logout() {
            console.log('🚪 Logging out user');
            
            try {
                await auth.signOut();
                console.log('✅ User logged out successfully');
            } catch (error) {
                console.error('❌ Logout error:', error);
            }
        }

        // 🎨 UI NAVIGATION FUNCTIONS
        function showLogin() {
            console.log('🎨 Showing login page');
            document.body.className = 'auth-mode';
            document.getElementById('containerWrapper').className = 'flex items-center justify-center min-h-screen w-full';
            hideAllPages();
            document.getElementById('loginPage').classList.remove('hidden');
            clearAllMessages();
        }

        function showSignup() {
            console.log('🎨 Showing signup page');
            document.body.className = 'auth-mode';
            document.getElementById('containerWrapper').className = 'flex items-center justify-center min-h-screen w-full';
            hideAllPages();
            document.getElementById('signupPage').classList.remove('hidden');
            clearAllMessages();
        }

        function showForgotPassword() {
            console.log('🎨 Showing forgot password page');
            document.body.className = 'auth-mode';
            document.getElementById('containerWrapper').className = 'flex items-center justify-center min-h-screen w-full';
            hideAllPages();
            document.getElementById('forgotPasswordPage').classList.remove('hidden');
            clearAllMessages();
        }

        function showEmailVerification() {
            console.log('🎨 Showing email verification page');
            document.body.className = 'auth-mode';
            document.getElementById('containerWrapper').className = 'flex items-center justify-center min-h-screen w-full';
            hideAllPages();
            document.getElementById('verificationPage').classList.remove('hidden');
            
            if (currentUser) {
                document.getElementById('verificationEmail').textContent = currentUser.email;
            }
            
            clearAllMessages();
        }

        function showMainApp() {
            console.log('🎨 Showing main app');
            document.body.className = 'app-mode';
            if (document.body.classList.contains('dark')) {
                document.body.classList.add('dark');
            }
            document.getElementById('containerWrapper').className = 'w-full';
            hideAllPages();
            document.getElementById('mainApp').classList.remove('hidden');
            
            if (currentUser) {
                document.getElementById('userDisplayName').textContent = currentUser.displayName || 'User';
                loadTasks();
                initializeChatbot();
            }
        }

        function hideAllPages() {
            const pages = ['loginPage', 'signupPage', 'forgotPasswordPage', 'verificationPage', 'mainApp'];
            pages.forEach(pageId => {
                document.getElementById(pageId).classList.add('hidden');
            });
        }

        // 📝 TASK MANAGEMENT FUNCTIONS
        function handleModalTaskSubmit(e) {
            e.preventDefault();
            console.log('📝 Modal task submission started');
            
            const taskName = document.getElementById('modalTaskName').value.trim();
            const taskDescription = document.getElementById('modalTaskDescription').value.trim();
            const taskPriority = document.getElementById('modalTaskPriority').value;
            const taskDueDate = document.getElementById('modalTaskDueDate').value;
            const submitBtn = document.querySelector('#modalTaskForm button[type="submit"]');
            
            if (!taskName) {
                alert('Please enter a task title');
                return;
            }
            
            if (taskName.length < 3) {
                alert('Task title must be at least 3 characters long');
                return;
            }
            
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = '⏳ Adding...';
            
            const taskData = {
                title: taskName,
                description: taskDescription,
                priority: taskPriority,
                dueDate: taskDueDate || null
            };
            
            try {
                console.log('💾 Saving task from modal:', taskData);
                const newTask = taskManager.addTask(taskData);
                console.log('✅ New task created from modal:', newTask);
                
                currentView = 'tasks';
                currentFilter = 'all';
                
                updateFilterButtons();
                showTasksView();
                loadTasks();
                
                console.log('✅ Task added successfully from modal and UI updated');
                
                submitBtn.textContent = '✅ Added!';
                
                setTimeout(() => {
                    closeAddTaskModal();
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }, 1000);
                
            } catch (error) {
                console.error('❌ Failed to add task from modal:', error);
                alert('Failed to add task. Please try again.');
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        function toggleTask(taskId) {
            console.log('🔄 Toggling task:', taskId);
            
            try {
                const tasks = taskManager.getTasks();
                const taskIndex = tasks.findIndex(task => task.id === taskId);
                
                if (taskIndex === -1) {
                    console.error('❌ Task not found:', taskId);
                    alert('Task not found. Please refresh the page.');
                    return;
                }
                
                tasks[taskIndex].completed = !tasks[taskIndex].completed;
                tasks[taskIndex].updatedAt = new Date().toISOString();
                
                taskManager.saveTasks(tasks);
                
                console.log(`✅ Task status updated to: ${tasks[taskIndex].completed ? 'completed' : 'pending'}`);
                
                loadTasks();
                
            } catch (error) {
                console.error('❌ Failed to toggle task:', error);
                alert('Failed to update task status. Please try again.');
                
                const checkbox = document.querySelector(`[data-task-id="${taskId}"] input[type="checkbox"]`);
                if (checkbox) {
                    checkbox.checked = !checkbox.checked;
                }
            }
        }

        function deleteTask(taskId) {
            console.log('🗑️ Deleting task:', taskId);
            
            if (!confirm('Are you sure you want to delete this task? This action cannot be undone.')) {
                return;
            }
            
            try {
                const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
                
                const tasks = taskManager.getTasks();
                const taskIndex = tasks.findIndex(task => task.id === taskId);
                
                if (taskIndex === -1) {
                    console.error('❌ Task not found:', taskId);
                    alert('Task not found. Please refresh the page.');
                    return;
                }
                
                tasks.splice(taskIndex, 1);
                taskManager.saveTasks(tasks);
                
                console.log('✅ Task deleted successfully from localStorage');
                
                if (taskElement) {
                    taskElement.style.transition = 'all 0.3s ease';
                    taskElement.style.transform = 'translateX(-100%)';
                    taskElement.style.opacity = '0';
                    
                    setTimeout(() => {
                        taskElement.remove();
                        loadTasks();
                    }, 300);
                } else {
                    loadTasks();
                }
                
            } catch (error) {
                console.error('❌ Failed to delete task:', error);
                alert('Failed to delete task. Please try again.');
            }
        }

        function editTask(taskId, field) {
            console.log('✏️ Editing task:', taskId, 'field:', field);
            
            const tasks = taskManager.getTasks();
            const task = tasks.find(t => t.id === taskId);
            if (!task) {
                alert('Task not found');
                return;
            }
            
            if (field === 'title') {
                const newTitle = prompt('Edit task title:', task.title);
                if (newTitle && newTitle.trim() && newTitle.trim() !== task.title) {
                    if (newTitle.trim().length < 3) {
                        alert('Task title must be at least 3 characters long');
                        return;
                    }
                    taskManager.updateTask(taskId, { title: newTitle.trim() });
                    loadTasks();
                }
            } else if (field === 'description') {
                const newDescription = prompt('Edit task description:', task.description || '');
                if (newDescription !== null) {
                    taskManager.updateTask(taskId, { description: newDescription.trim() });
                    loadTasks();
                }
            } else if (field === 'priority') {
                const priorities = ['low', 'medium', 'high'];
                const currentIndex = priorities.indexOf(task.priority);
                const newIndex = (currentIndex + 1) % priorities.length;
                taskManager.updateTask(taskId, { priority: priorities[newIndex] });
                loadTasks();
            }
        }

        // 🎯 MODAL FUNCTIONS
        function openAddTaskModal() {
            console.log('🎯 Opening add task modal');
            const modal = document.getElementById('addTaskModal');
            modal.classList.remove('opacity-0', 'invisible');
            modal.classList.add('opacity-100', 'visible');
            modal.querySelector('.bg-white').classList.remove('scale-95');
            modal.querySelector('.bg-white').classList.add('scale-100');
            
            setTimeout(() => {
                document.getElementById('modalTaskName').focus();
            }, 300);
            
            document.body.style.overflow = 'hidden';
        }

        function closeAddTaskModal() {
            console.log('🎯 Closing add task modal');
            const modal = document.getElementById('addTaskModal');
            modal.classList.remove('opacity-100', 'visible');
            modal.classList.add('opacity-0', 'invisible');
            modal.querySelector('.bg-white').classList.remove('scale-100');
            modal.querySelector('.bg-white').classList.add('scale-95');
            
            document.getElementById('modalTaskForm').reset();
            document.getElementById('modalTaskPriority').value = 'medium';
            
            document.body.style.overflow = '';
        }

        function filterTasks(filter) {
            currentFilter = filter;
            currentView = 'tasks';
            
            updateFilterButtons();
            showTasksView();
            loadTasks();
        }

        function updateFilterButtons() {
            document.querySelectorAll('.filter-chip').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === currentFilter) {
                    btn.classList.add('active');
                }
            });
        }

        // 📅 CALENDAR FUNCTIONS
        function showCalendar() {
            console.log('📅 Showing calendar view');
            currentView = 'calendar';
            
            document.querySelectorAll('.filter-chip').forEach(btn => {
                btn.classList.remove('active');
            });
            
            showCalendarView();
            renderCalendar();
        }

        function showTasksView() {
            document.getElementById('tasksList').classList.remove('hidden');
            document.getElementById('calendarView').classList.add('hidden');
            document.getElementById('dateTasksView').classList.add('hidden');
        }

        function showCalendarView() {
            document.getElementById('tasksList').classList.add('hidden');
            document.getElementById('calendarView').classList.remove('hidden');
            document.getElementById('dateTasksView').classList.add('hidden');
        }

        function showDateTasksView() {
            document.getElementById('tasksList').classList.add('hidden');
            document.getElementById('calendarView').classList.add('hidden');
            document.getElementById('dateTasksView').classList.remove('hidden');
        }

        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            const monthNames = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            document.getElementById('calendarTitle').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            const tasks = taskManager.getTasks();
            const tasksByDate = {};
            
            tasks.forEach(task => {
                if (task.dueDate) {
                    const taskDate = new Date(task.dueDate);
                    const dateKey = `${taskDate.getFullYear()}-${String(taskDate.getMonth() + 1).padStart(2, '0')}-${String(taskDate.getDate()).padStart(2, '0')}`;
                    if (!tasksByDate[dateKey]) {
                        tasksByDate[dateKey] = [];
                    }
                    tasksByDate[dateKey].push(task);
                }
            });
            
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';
            
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'text-center font-semibold text-gray-600 dark:text-gray-400 py-2';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'p-2';
                calendarGrid.appendChild(emptyDay);
            }
            
            const today = new Date();
            const todayDateKey = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayTasks = tasksByDate[dateKey] || [];
                
                let dayClasses = 'p-2 text-center cursor-pointer rounded-lg transition-all hover:bg-gray-100 dark:hover:bg-gray-700 relative';
                
                if (dateKey === todayDateKey) {
                    dayClasses += ' bg-green-500 text-white font-bold';
                } else if (dayTasks.length > 0) {
                    dayClasses += ' bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 font-semibold';
                }
                
                if (selectedDate && selectedDate === dateKey) {
                    dayClasses += ' ring-2 ring-blue-500';
                }
                
                dayElement.className = dayClasses;
                dayElement.innerHTML = `
                    <div>${day}</div>
                    ${dayTasks.length > 0 ? `<div class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></div>` : ''}
                `;
                
                dayElement.addEventListener('click', () => selectDate(dateKey));
                calendarGrid.appendChild(dayElement);
            }
            
            console.log(`📅 Calendar rendered for ${monthNames[month]} ${year}`);
        }

        function changeMonth(direction) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            renderCalendar();
        }

        function selectDate(dateKey) {
            console.log('📅 Date selected:', dateKey);
            selectedDate = dateKey;
            currentView = 'date-tasks';
            
            renderCalendar();
            showDateTasksView();
            loadDateTasks(dateKey);
        }

        function loadDateTasks(dateKey) {
            const tasks = taskManager.getTasks();
            const dateTasks = tasks.filter(task => {
                if (!task.dueDate) return false;
                const taskDate = new Date(task.dueDate);
                const taskDateKey = `${taskDate.getFullYear()}-${String(taskDate.getMonth() + 1).padStart(2, '0')}-${String(taskDate.getDate()).padStart(2, '0')}`;
                return taskDateKey === dateKey;
            });
            
            const date = new Date(dateKey);
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('selectedDateTitle').textContent = `Tasks for ${date.toLocaleDateString('en-US', options)}`;
            
            const dateTasksList = document.getElementById('dateTasksList');
            
            if (dateTasks.length === 0) {
                dateTasksList.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">📅</div>
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No tasks for this date</h3>
                        <p class="text-gray-600 dark:text-gray-400">Add a task with a due date to see it here!</p>
                    </div>
                `;
            } else {
                dateTasksList.innerHTML = dateTasks.map(task => createTaskHTML(task, true)).join('');
            }
            
            console.log(`📅 Loaded ${dateTasks.length} tasks for ${dateKey}`);
        }

        function backToCalendar() {
            console.log('📅 Back to calendar view');
            currentView = 'calendar';
            showCalendarView();
            renderCalendar();
        }

        function clearCompletedTasks() {
            console.log('🗑️ Clear completed tasks requested');
            
            const allTasks = taskManager.getTasks();
            const completedTasks = allTasks.filter(task => task.completed);
            
            if (completedTasks.length === 0) {
                alert('No completed tasks to clear!');
                return;
            }
            
            const confirmMessage = `Are you sure you want to delete ${completedTasks.length} completed task${completedTasks.length === 1 ? '' : 's'}? This action cannot be undone.`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            try {
                const pendingTasks = allTasks.filter(task => !task.completed);
                const clearedCount = allTasks.length - pendingTasks.length;
                
                taskManager.saveTasks(pendingTasks);
                
                if (clearedCount > 0) {
                    console.log(`✅ Successfully cleared ${clearedCount} completed tasks`);
                    
                    const clearBtn = document.getElementById('clearCompletedBtn');
                    const originalText = clearBtn.textContent;
                    clearBtn.textContent = `✅ Cleared ${clearedCount}!`;
                    clearBtn.disabled = true;
                    
                    setTimeout(() => {
                        clearBtn.textContent = originalText;
                        clearBtn.disabled = false;
                    }, 2000);
                    
                    loadTasks();
                } else {
                    alert('No completed tasks found to clear.');
                }
                
            } catch (error) {
                console.error('❌ Failed to clear completed tasks:', error);
                alert('Failed to clear completed tasks. Please try again.');
            }
        }

        function createTaskHTML(task, isDateView = false) {
            const createdAt = new Date(task.createdAt).toLocaleDateString();
            
            const priorityConfig = {
                'high': { emoji: '🔴', color: 'red', label: 'HIGH' },
                'medium': { emoji: '🟡', color: 'yellow', label: 'MEDIUM' },
                'low': { emoji: '🟢', color: 'green', label: 'LOW' }
            };
            
            const priority = priorityConfig[task.priority];
            
            let dueDateInfo = '';
            let dueDateClass = '';
            if (task.dueDate) {
                const dueDate = new Date(task.dueDate);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                dueDate.setHours(0, 0, 0, 0);
                
                const diffTime = dueDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays < 0) {
                    dueDateInfo = `Overdue by ${Math.abs(diffDays)} day${Math.abs(diffDays) === 1 ? '' : 's'}`;
                    dueDateClass = 'due-overdue';
                } else if (diffDays === 0) {
                    dueDateInfo = 'Due Today';
                    dueDateClass = 'due-today';
                } else if (diffDays === 1) {
                    dueDateInfo = 'Due Tomorrow';
                    dueDateClass = 'due-soon';
                } else if (diffDays <= 7) {
                    dueDateInfo = `Due in ${diffDays} days`;
                    dueDateClass = 'due-soon';
                } else {
                    dueDateInfo = `Due ${dueDate.toLocaleDateString()}`;
                    dueDateClass = 'due-later';
                }
            }
            
            return `
                <div class="task-card bg-white dark:bg-gray-700 rounded-xl shadow-sm border border-gray-200 dark:border-gray-600 p-4 hover-lift transition-all ${task.completed ? 'opacity-60' : ''}" data-task-id="${task.id}">
                    <div class="flex items-start space-x-4">
                        <input type="checkbox" ${task.completed ? 'checked' : ''} 
                               onchange="toggleTask('${task.id}'); ${isDateView ? `loadDateTasks('${selectedDate}')` : 'loadTasks()'}"
                               class="mt-1 w-5 h-5 text-blue-600 rounded focus:ring-blue-500">
                        
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white ${task.completed ? 'line-through' : ''}" 
                                    onclick="editTask('${task.id}', 'title')" title="Click to edit">
                                    ${escapeHtml(task.title)}
                                </h3>
                                <div class="flex items-center space-x-2">
                                    <span class="priority-${task.priority} px-2 py-1 rounded-full text-xs font-semibold">
                                        ${priority.emoji} ${priority.label}
                                    </span>
                                    <div class="relative">
                                        <button onclick="toggleTaskMenu('${task.id}')" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                            <span class="text-gray-400">⋯</span>
                                        </button>
                                        <div id="menu-${task.id}" class="dropdown-menu absolute right-0 mt-2 w-48 bg-white dark:bg-gray-700 rounded-lg shadow-lg border border-gray-200 dark:border-gray-600 z-10">
                                            <button onclick="editTask('${task.id}', 'title')" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-t-lg">
                                                ✏️ Edit Title
                                            </button>
                                            <button onclick="editTask('${task.id}', 'description')" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600">
                                                📝 Edit Description
                                            </button>
                                            <button onclick="editTask('${task.id}', 'priority')" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600">
                                                🎯 Change Priority
                                            </button>
                                            <button onclick="deleteTask('${task.id}'); ${isDateView ? `loadDateTasks('${selectedDate}')` : 'loadTasks()'}" class="w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-b-lg">
                                                🗑️ Delete Task
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            ${task.description ? `
                                <p class="text-gray-600 dark:text-gray-400 mb-3 ${task.completed ? 'line-through' : ''}" 
                                   onclick="editTask('${task.id}', 'description')" title="Click to edit">
                                    ${escapeHtml(task.description)}
                                </p>
                            ` : `
                                <p class="text-gray-400 dark:text-gray-500 mb-3 italic cursor-pointer" 
                                   onclick="editTask('${task.id}', 'description')" title="Click to add description">
                                    + Add description
                                </p>
                            `}
                            
                            <div class="flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400">
                                <span>📅 Created: ${createdAt}</span>
                                ${dueDateInfo ? `<span class="${dueDateClass} px-2 py-1 rounded-full text-xs font-medium">${dueDateInfo}</span>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function toggleTaskMenu(taskId) {
            // Close all other menus
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                if (menu.id !== `menu-${taskId}`) {
                    menu.classList.remove('show');
                }
            });
            
            // Toggle current menu
            const menu = document.getElementById(`menu-${taskId}`);
            menu.classList.toggle('show');
            
            // Close menu when clicking outside
            setTimeout(() => {
                document.addEventListener('click', function closeMenu(e) {
                    if (!menu.contains(e.target) && !e.target.closest(`[onclick="toggleTaskMenu('${taskId}')"]`)) {
                        menu.classList.remove('show');
                        document.removeEventListener('click', closeMenu);
                    }
                });
            }, 0);
        }

        function loadTasks() {
            try {
                const allTasks = taskManager.getTasks();
                let filteredTasks = taskManager.getFilteredTasks(currentFilter);
                
                // Apply search filter
                if (searchQuery) {
                    filteredTasks = filteredTasks.filter(task => 
                        task.title.toLowerCase().includes(searchQuery) ||
                        (task.description && task.description.toLowerCase().includes(searchQuery))
                    );
                }
                
                console.log(`📋 Loading tasks: ${filteredTasks.length} of ${allTasks.length} tasks (filter: ${currentFilter}, search: "${searchQuery}")`);
                
                updateProgress(allTasks);
                updateFilterCounts(allTasks);
                updateClearCompletedButton(allTasks);
                
                const tasksList = document.getElementById('tasksList');
                const emptyState = document.getElementById('emptyState');
                
                if (filteredTasks.length === 0) {
                    tasksList.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    
                    if (searchQuery) {
                        emptyState.innerHTML = `
                            <div class="text-6xl mb-4">🔍</div>
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No tasks found</h3>
                            <p class="text-gray-600 dark:text-gray-400">No tasks match your search for "${searchQuery}"</p>
                        `;
                    } else if (currentFilter === 'pending') {
                        emptyState.innerHTML = `
                            <div class="text-6xl mb-4 animate-bounce-gentle">🎉</div>
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No pending tasks</h3>
                            <p class="text-gray-600 dark:text-gray-400">Great job! All your tasks are completed.</p>
                        `;
                    } else if (currentFilter === 'completed') {
                        emptyState.innerHTML = `
                            <div class="text-6xl mb-4">✅</div>
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No completed tasks</h3>
                            <p class="text-gray-600 dark:text-gray-400">Complete some tasks to see them here.</p>
                        `;
                    } else {
                        emptyState.innerHTML = `
                            <div class="text-6xl mb-4 animate-bounce-gentle">📝</div>
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No tasks yet</h3>
                            <p class="text-gray-600 dark:text-gray-400">Click "Add New Task" to get started on your productivity journey!</p>
                        `;
                    }
                } else {
                    emptyState.classList.add('hidden');
                    tasksList.innerHTML = filteredTasks.map(task => createTaskHTML(task)).join('');
                }
            } catch (error) {
                console.error('❌ Failed to load tasks:', error);
            }
        }

        function updateProgress(tasks) {
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.completed).length;
            const pendingTasks = totalTasks - completedTasks;
            const percentage = totalTasks === 0 ? 0 : Math.round((completedTasks / totalTasks) * 100);
            
            const progressPercentage = document.getElementById('progressPercentage');
            const completedCount = document.getElementById('completedCount');
            const pendingCount = document.getElementById('pendingCount');
            const totalCount = document.getElementById('totalCount');
            const progressRing = document.getElementById('progressRing');
            
            progressPercentage.textContent = `${percentage}%`;
            completedCount.textContent = completedTasks;
            pendingCount.textContent = pendingTasks;
            totalCount.textContent = totalTasks;
            
            const circumference = 2 * Math.PI * 60;
            const offset = circumference - (percentage / 100) * circumference;
            
            progressRing.style.strokeDashoffset = offset;
            
            if (percentage === 100 && totalTasks > 0) {
                progressRing.classList.add('animate');
                setTimeout(() => {
                    progressRing.classList.remove('animate');
                }, 1500);
            }
            
            console.log(`📊 Progress updated: ${percentage}% (${completedTasks}/${totalTasks} tasks)`);
        }

        function updateFilterCounts(tasks) {
            const allCount = tasks.length;
            const pendingCount = tasks.filter(t => !t.completed).length;
            const completedCount = tasks.filter(t => t.completed).length;
            
            document.getElementById('allCount').textContent = allCount;
            document.getElementById('pendingFilterCount').textContent = pendingCount;
            document.getElementById('completedFilterCount').textContent = completedCount;
        }

        function updateClearCompletedButton(tasks) {
            const clearBtn = document.getElementById('clearCompletedBtn');
            if (!clearBtn) return;
            
            const completedTasks = tasks.filter(task => task.completed);
            const hasCompletedTasks = completedTasks.length > 0;
            
            clearBtn.disabled = !hasCompletedTasks;
            
            if (hasCompletedTasks) {
                clearBtn.textContent = `🗑️ Clear Completed (${completedTasks.length})`;
                clearBtn.title = `Remove ${completedTasks.length} completed task${completedTasks.length === 1 ? '' : 's'}`;
            } else {
                clearBtn.textContent = '🗑️ Clear Completed';
                clearBtn.title = 'No completed tasks to clear';
            }
        }

        // 🛠️ UTILITY FUNCTIONS
        function setButtonLoading(button, loading) {
            const btnText = button.querySelector('.btn-text');
            if (loading) {
                button.disabled = true;
                btnText.innerHTML = '<div class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>Loading...';
            } else {
                button.disabled = false;
                const buttonId = button.id;
                if (buttonId === 'loginBtn') {
                    btnText.textContent = 'Sign In';
                } else if (buttonId === 'signupBtn') {
                    btnText.textContent = 'Create Account';
                } else if (buttonId === 'forgotBtn') {
                    btnText.textContent = 'Send Reset Email';
                } else if (buttonId === 'resendBtn') {
                    btnText.textContent = 'Resend Verification Email';
                } else if (buttonId === 'checkVerificationBtn') {
                    btnText.textContent = "I've Verified My Email";
                }
            }
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.innerHTML = message;
            errorElement.classList.remove('hidden');
            console.log('❌ Error shown:', message);
        }

        function showSuccess(elementId, message) {
            const successElement = document.getElementById(elementId);
            successElement.textContent = message;
            successElement.classList.remove('hidden');
            console.log('✅ Success shown:', message);
        }

        function clearMessages(prefix) {
            const errorElement = document.getElementById(prefix + 'Error');
            const successElement = document.getElementById(prefix + 'Success');
            
            if (errorElement) errorElement.classList.add('hidden');
            if (successElement) successElement.classList.add('hidden');
        }

        function clearAllMessages() {
            ['login', 'signup', 'forgot', 'verification'].forEach(prefix => {
                clearMessages(prefix);
            });
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'Hide';
            } else {
                input.type = 'password';
                button.textContent = 'Show';
            }
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function handleAuthError(error, elementId) {
            let errorMessage = 'An unexpected error occurred. Please try again.';
            
            switch (error.code) {
                case 'auth/user-not-found':
                    errorMessage = 'No account found with this email address.';
                    break;
                case 'auth/wrong-password':
                    errorMessage = 'Incorrect password. Please try again.';
                    break;
                case 'auth/invalid-email':
                    errorMessage = 'Please enter a valid email address.';
                    break;
                case 'auth/user-disabled':
                    errorMessage = 'This account has been disabled. Please contact support.';
                    break;
                case 'auth/too-many-requests':
                    errorMessage = 'Too many failed attempts. Please try again later or reset your password.';
                    break;
                case 'auth/email-already-in-use':
                    errorMessage = 'An account with this email already exists. <a href="#" onclick="showLogin()" class="text-blue-600 hover:text-blue-700 font-semibold underline">Sign in instead</a>';
                    break;
                case 'auth/weak-password':
                    errorMessage = 'Password is too weak. Please choose a stronger password.';
                    break;
                case 'auth/operation-not-allowed':
                    errorMessage = 'Email/password accounts are not enabled. Please contact support.';
                    break;
                case 'auth/network-request-failed':
                    errorMessage = 'Network error. Please check your internet connection and try again.';
                    break;
                case 'auth/invalid-credential':
                    errorMessage = 'Invalid credentials. Please check your email and password.';
                    break;
                case 'auth/requires-recent-login':
                    errorMessage = 'Please sign in again to complete this action.';
                    break;
                default:
                    console.error('Unhandled auth error:', error.code, error.message);
                    errorMessage = `Error: ${error.message}`;
            }
            
            showError(elementId, errorMessage);
        }

        function checkPasswordStrength() {
            const password = document.getElementById('signupPassword').value;
            const strengthElement = document.getElementById('passwordStrength');
            const requirementsElement = document.getElementById('passwordRequirements');
            
            if (password.length === 0) {
                strengthElement.textContent = '';
                requirementsElement.innerHTML = '';
                return;
            }
            
            const requirements = {
                length: password.length >= 8,
                lowercase: /[a-z]/.test(password),
                uppercase: /[A-Z]/.test(password),
                number: /\d/.test(password),
                special: /[^a-zA-Z\d]/.test(password)
            };
            
            const metRequirements = Object.values(requirements).filter(Boolean).length;
            
            if (metRequirements <= 2) {
                strengthElement.textContent = 'Weak';
                strengthElement.className = 'text-red-600 font-medium';
            } else if (metRequirements <= 3) {
                strengthElement.textContent = 'Medium';
                strengthElement.className = 'text-yellow-600 font-medium';
            } else {
                strengthElement.textContent = 'Strong';
                strengthElement.className = 'text-green-600 font-medium';
            }
            
            const requirementsList = [
                { text: 'At least 8 characters', met: requirements.length },
                { text: 'One lowercase letter', met: requirements.lowercase },
                { text: 'One uppercase letter', met: requirements.uppercase },
                { text: 'One number', met: requirements.number },
                { text: 'One special character', met: requirements.special }
            ];
            
            requirementsElement.innerHTML = `
                <div class="text-xs text-gray-500 dark:text-gray-400">
                    <div class="font-medium mb-1">Password requirements:</div>
                    <ul class="space-y-1">
                        ${requirementsList.map(req => `
                            <li class="${req.met ? 'text-green-600 line-through' : ''}">${req.text}</li>
                        `).join('')}
                    </ul>
                </div>
            `;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // 👤 ACCOUNT MANAGEMENT FUNCTIONS
        function toggleAccountMenu() {
            const menu = document.getElementById('accountMenu');
            menu.classList.toggle('show');
            
            // Close menu when clicking outside
            setTimeout(() => {
                document.addEventListener('click', function closeAccountMenu(e) {
                    if (!menu.contains(e.target) && !e.target.closest(`[onclick="toggleAccountMenu()"]`)) {
                        menu.classList.remove('show');
                        document.removeEventListener('click', closeAccountMenu);
                    }
                });
            }, 0);
        }

        function openAccountSettings() {
            console.log('⚙️ Opening account settings');
            
            if (!currentUser) {
                alert('No user signed in');
                return;
            }
            
            // Pre-fill current user data
            document.getElementById('accountName').value = currentUser.displayName || '';
            document.getElementById('accountEmail').value = currentUser.email || '';
            
            const modal = document.getElementById('accountSettingsModal');
            modal.classList.remove('opacity-0', 'invisible');
            modal.classList.add('opacity-100', 'visible');
            modal.querySelector('.bg-white').classList.remove('scale-95');
            modal.querySelector('.bg-white').classList.add('scale-100');
            
            document.body.style.overflow = 'hidden';
            clearMessages('account');
            
            // Close account menu
            document.getElementById('accountMenu').classList.remove('show');
        }

        function closeAccountSettings() {
            console.log('⚙️ Closing account settings');
            const modal = document.getElementById('accountSettingsModal');
            modal.classList.remove('opacity-100', 'visible');
            modal.classList.add('opacity-0', 'invisible');
            modal.querySelector('.bg-white').classList.remove('scale-100');
            modal.querySelector('.bg-white').classList.add('scale-95');
            
            document.getElementById('accountSettingsForm').reset();
            document.body.style.overflow = '';
            clearMessages('account');
        }

        function openChangePassword() {
            console.log('🔒 Opening change password');
            
            const modal = document.getElementById('changePasswordModal');
            modal.classList.remove('opacity-0', 'invisible');
            modal.classList.add('opacity-100', 'visible');
            modal.querySelector('.bg-white').classList.remove('scale-95');
            modal.querySelector('.bg-white').classList.add('scale-100');
            
            document.body.style.overflow = 'hidden';
            clearMessages('password');
            
            // Close account menu
            document.getElementById('accountMenu').classList.remove('show');
        }

        function closeChangePassword() {
            console.log('🔒 Closing change password');
            const modal = document.getElementById('changePasswordModal');
            modal.classList.remove('opacity-100', 'visible');
            modal.classList.add('opacity-0', 'invisible');
            modal.querySelector('.bg-white').classList.remove('scale-100');
            modal.querySelector('.bg-white').classList.add('scale-95');
            
            document.getElementById('changePasswordForm').reset();
            document.getElementById('newPasswordStrength').textContent = '';
            document.body.style.overflow = '';
            clearMessages('password');
        }

        async function handleAccountSettings(e) {
            e.preventDefault();
            console.log('⚙️ Account settings update started');
            
            if (!currentUser) {
                showError('accountError', 'No user signed in');
                return;
            }
            
            const newName = document.getElementById('accountName').value.trim();
            const newEmail = document.getElementById('accountEmail').value.trim();
            const submitBtn = document.querySelector('#accountSettingsForm button[type="submit"]');
            
            if (!newName || !newEmail) {
                showError('accountError', 'Please fill in all fields');
                return;
            }
            
            if (newName.length < 2) {
                showError('accountError', 'Name must be at least 2 characters long');
                return;
            }
            
            if (!isValidEmail(newEmail)) {
                showError('accountError', 'Please enter a valid email address');
                return;
            }
            
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>Updating...';
            clearMessages('account');
            
            try {
                let hasChanges = false;
                let nameChanged = false;
                let emailChanged = false;
                
                // Update display name if changed
                if (newName !== (currentUser.displayName || '')) {
                    await currentUser.updateProfile({
                        displayName: newName
                    });
                    console.log('✅ Display name updated');
                    hasChanges = true;
                    nameChanged = true;
                    
                    // Update UI immediately
                    document.getElementById('userDisplayName').textContent = newName;
                }
                
                // Update email if changed
                if (newEmail !== currentUser.email) {
                    await currentUser.updateEmail(newEmail);
                    console.log('✅ Email updated, verification email sent');
                    hasChanges = true;
                    emailChanged = true;
                    
                    // Update UI immediately
                    document.getElementById('userEmail').textContent = newEmail;
                }
                
                if (!hasChanges) {
                    showError('accountError', 'No changes were made');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                    return;
                }
                
                // Show success message based on what was changed
                submitBtn.innerHTML = '✅ Updated!';
                
                if (nameChanged && emailChanged) {
                    showSuccess('accountSuccess', '🎉 Name and email updated successfully! Please check your new email for verification.');
                } else if (nameChanged) {
                    showSuccess('accountSuccess', '🎉 Name updated successfully!');
                } else if (emailChanged) {
                    showSuccess('accountSuccess', '🎉 Email updated successfully! Please check your new email for verification.');
                }
                
                setTimeout(() => {
                    closeAccountSettings();
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                }, 2000);
                
            } catch (error) {
                console.error('❌ Account settings error:', error);
                
                if (error.code === 'auth/email-already-in-use') {
                    showError('accountError', 'This email is already in use by another account');
                } else if (error.code === 'auth/invalid-email') {
                    showError('accountError', 'Please enter a valid email address');
                } else if (error.code === 'auth/requires-recent-login') {
                    showError('accountError', 'Session expired. Please sign out and sign in again to update your email');
                } else if (error.code === 'auth/too-many-requests') {
                    showError('accountError', 'Too many requests. Please wait a few minutes before trying again');
                } else {
                    showError('accountError', `Failed to update account: ${error.message}`);
                }
                
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        }

        async function handleChangePassword(e) {
            e.preventDefault();
            console.log('🔒 Password change started');
            
            if (!currentUser) {
                showError('passwordError', 'No user signed in');
                return;
            }
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const submitBtn = document.querySelector('#changePasswordForm button[type="submit"]');
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showError('passwordError', 'Please fill in all fields');
                return;
            }
            
            if (newPassword.length < 6) {
                showError('passwordError', 'New password must be at least 6 characters long');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showError('passwordError', 'New passwords do not match');
                return;
            }
            
            if (currentPassword === newPassword) {
                showError('passwordError', 'New password must be different from current password');
                return;
            }
            
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>Updating Password...';
            clearMessages('password');
            
            try {
                // Re-authenticate user with current password
                const credential = firebase.auth.EmailAuthProvider.credential(
                    currentUser.email,
                    currentPassword
                );
                
                await currentUser.reauthenticateWithCredential(credential);
                console.log('✅ User re-authenticated');
                
                // Update password
                await currentUser.updatePassword(newPassword);
                console.log('✅ Password updated successfully');
                
                submitBtn.innerHTML = '✅ Password Updated!';
                showSuccess('passwordSuccess', '🎉 Password updated successfully! You will be automatically logged out in 3 seconds for security...');
                
                // Clear form
                document.getElementById('changePasswordForm').reset();
                document.getElementById('newPasswordStrength').textContent = '';
                
                // Sign out user after password change
                setTimeout(async () => {
                    try {
                        closeChangePassword();
                        await auth.signOut();
                        console.log('✅ User signed out after password change');
                        alert('Password changed successfully! Please sign in with your new password.');
                    } catch (signOutError) {
                        console.error('❌ Sign out error:', signOutError);
                        await auth.signOut(); // Force sign out
                    }
                }, 3000);
                
            } catch (error) {
                console.error('❌ Password change error:', error);
                
                if (error.code === 'auth/wrong-password') {
                    showError('passwordError', 'Current password is incorrect. Please try again.');
                } else if (error.code === 'auth/weak-password') {
                    showError('passwordError', 'New password is too weak. Please choose a stronger password.');
                } else if (error.code === 'auth/requires-recent-login') {
                    showError('passwordError', 'Session expired. Please sign out and sign in again to change your password.');
                } else if (error.code === 'auth/too-many-requests') {
                    showError('passwordError', 'Too many attempts. Please wait a few minutes before trying again.');
                } else {
                    showError('passwordError', `Failed to update password: ${error.message}`);
                }
                
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        }

        function checkNewPasswordStrength() {
            const password = document.getElementById('newPassword').value;
            const strengthElement = document.getElementById('newPasswordStrength');
            
            if (password.length === 0) {
                strengthElement.textContent = '';
                return;
            }
            
            const requirements = {
                length: password.length >= 8,
                lowercase: /[a-z]/.test(password),
                uppercase: /[A-Z]/.test(password),
                number: /\d/.test(password),
                special: /[^a-zA-Z\d]/.test(password)
            };
            
            const metRequirements = Object.values(requirements).filter(Boolean).length;
            
            if (metRequirements <= 2) {
                strengthElement.textContent = 'Weak';
                strengthElement.className = 'text-red-600 font-medium';
            } else if (metRequirements <= 3) {
                strengthElement.textContent = 'Medium';
                strengthElement.className = 'text-yellow-600 font-medium';
            } else {
                strengthElement.textContent = 'Strong';
                strengthElement.className = 'text-green-600 font-medium';
            }
        }

        function checkPasswordMatch() {
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmSignupPassword').value;
            const messageElement = document.getElementById('confirmPasswordMessage');
            
            if (confirmPassword.length === 0) {
                messageElement.textContent = '';
                return;
            }
            
            if (password === confirmPassword) {
                messageElement.textContent = '✅ Passwords match';
                messageElement.className = 'text-green-600 font-medium';
            } else {
                messageElement.textContent = '❌ Passwords do not match';
                messageElement.className = 'text-red-600 font-medium';
            }
        }

        // 🤖 CHATBOT FUNCTIONS
        function initializeChatbot() {
            console.log('🤖 Initializing AI chatbot');
            
            // Start reminder system
            startReminderSystem();
            
            // Check for overdue tasks on startup
            setTimeout(() => {
                checkForOverdueTasks();
            }, 5000);
        }

        function toggleChatbot() {
            const modal = document.getElementById('chatbotModal');
            chatbotOpen = !chatbotOpen;
            
            if (chatbotOpen) {
                modal.classList.remove('translate-y-full', 'opacity-0');
                modal.classList.add('translate-y-0', 'opacity-100');
                
                // Focus on input
                setTimeout(() => {
                    document.getElementById('chatInput').focus();
                }, 300);
                
                // Hide notification
                document.getElementById('chatNotification').classList.add('hidden');
            } else {
                modal.classList.remove('translate-y-0', 'opacity-100');
                modal.classList.add('translate-y-full', 'opacity-0');
            }
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        function sendQuickMessage(message) {
            document.getElementById('chatInput').value = message;
            sendChatMessage();
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addChatMessage(message, 'user');
            input.value = '';
            
            // Process message and respond
            setTimeout(() => {
                const response = processAIMessage(message);
                addChatMessage(response, 'ai');
            }, 500);
        }

        function addChatMessage(message, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start space-x-3';
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm">
                        👤
                    </div>
                    <div class="bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3 max-w-xs">
                        <p class="text-sm text-gray-800 dark:text-gray-200">${escapeHtml(message)}</p>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white text-sm">
                        🤖
                    </div>
                    <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-3 max-w-xs">
                        <p class="text-sm text-gray-800 dark:text-gray-200">${message}</p>
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function processAIMessage(message) {
            const lowerMessage = message.toLowerCase();
            const tasks = taskManager.getTasks();
            const completedTasks = tasks.filter(t => t.completed);
            const pendingTasks = tasks.filter(t => !t.completed);
            
            // Task summary queries
            if (lowerMessage.includes('how many') && lowerMessage.includes('task')) {
                return `📊 <strong>Task Summary:</strong><br>
                        • Total tasks: ${tasks.length}<br>
                        • Completed: ${completedTasks.length}<br>
                        • Pending: ${pendingTasks.length}<br>
                        • Completion rate: ${tasks.length > 0 ? Math.round((completedTasks.length / tasks.length) * 100) : 0}%`;
            }
            
            // Due today queries
            if (lowerMessage.includes('due today') || lowerMessage.includes('today')) {
                const today = new Date().toISOString().split('T')[0];
                const todayTasks = tasks.filter(t => t.dueDate === today && !t.completed);
                
                if (todayTasks.length === 0) {
                    return `📅 <strong>Great news!</strong> You have no tasks due today. Perfect time to get ahead on tomorrow's work! 🎉`;
                } else {
                    const taskList = todayTasks.map(t => `• ${t.title}`).join('<br>');
                    return `📅 <strong>Tasks due today (${todayTasks.length}):</strong><br>${taskList}<br><br>💪 You've got this! Focus on one task at a time.`;
                }
            }
            
            // Overdue tasks
            if (lowerMessage.includes('overdue') || lowerMessage.includes('late')) {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const overdueTasks = tasks.filter(t => {
                    if (!t.dueDate || t.completed) return false;
                    const dueDate = new Date(t.dueDate);
                    dueDate.setHours(0, 0, 0, 0);
                    return dueDate < today;
                });
                
                if (overdueTasks.length === 0) {
                    return `✅ <strong>Excellent!</strong> You have no overdue tasks. You're staying on top of your schedule! 🌟`;
                } else {
                    const taskList = overdueTasks.map(t => `• ${t.title}`).join('<br>');
                    return `⚠️ <strong>Overdue tasks (${overdueTasks.length}):</strong><br>${taskList}<br><br>💡 <em>Tip: Consider breaking these into smaller, manageable chunks!</em>`;
                }
            }
            
            // High priority tasks
            if (lowerMessage.includes('priority') || lowerMessage.includes('important')) {
                const highPriorityTasks = pendingTasks.filter(t => t.priority === 'high');
                
                if (highPriorityTasks.length === 0) {
                    return `🎯 <strong>No high-priority tasks pending!</strong> You can focus on medium and low priority items, or take a well-deserved break! 😊`;
                } else {
                    const taskList = highPriorityTasks.map(t => `• ${t.title}`).join('<br>');
                    return `🔴 <strong>High priority tasks (${highPriorityTasks.length}):</strong><br>${taskList}<br><br>🚀 <em>These should be your top focus right now!</em>`;
                }
            }
            
            // Productivity tips
            if (lowerMessage.includes('tip') || lowerMessage.includes('advice') || lowerMessage.includes('help')) {
                const tips = [
                    "🍅 <strong>Pomodoro Technique:</strong> Work for 25 minutes, then take a 5-minute break. This helps maintain focus and prevents burnout!",
                    "📝 <strong>Two-Minute Rule:</strong> If a task takes less than 2 minutes, do it immediately instead of adding it to your list!",
                    "🎯 <strong>Eat the Frog:</strong> Tackle your most challenging or important task first thing in the morning when your energy is highest!",
                    "📊 <strong>Time Blocking:</strong> Assign specific time slots to different types of tasks. This helps you stay focused and realistic about your schedule!",
                    "🧹 <strong>Weekly Review:</strong> Spend 15 minutes each week reviewing completed tasks and planning ahead. Celebrate your wins!",
                    "⚡ <strong>Energy Management:</strong> Schedule demanding tasks when you have the most energy, and easier tasks when you're tired!",
                    "🎨 <strong>Task Batching:</strong> Group similar tasks together (like all your emails or phone calls) to minimize context switching!"
                ];
                
                const randomTip = tips[Math.floor(Math.random() * tips.length)];
                return `💡 ${randomTip}`;
            }
            
            // Progress and motivation
            if (lowerMessage.includes('progress') || lowerMessage.includes('how am i doing')) {
                const completionRate = tasks.length > 0 ? Math.round((completedTasks.length / tasks.length) * 100) : 0;
                let motivationalMessage = '';
                
                if (completionRate >= 80) {
                    motivationalMessage = "🌟 Outstanding! You're absolutely crushing it!";
                } else if (completionRate >= 60) {
                    motivationalMessage = "💪 Great job! You're making solid progress!";
                } else if (completionRate >= 40) {
                    motivationalMessage = "📈 Good work! Keep the momentum going!";
                } else {
                    motivationalMessage = "🚀 Every journey starts with a single step. You've got this!";
                }
                
                return `📊 <strong>Your Progress:</strong><br>
                        • Completion rate: ${completionRate}%<br>
                        • Tasks completed: ${completedTasks.length}<br>
                        • Tasks remaining: ${pendingTasks.length}<br><br>
                        ${motivationalMessage}`;
            }
            
            // Motivation and encouragement
            if (lowerMessage.includes('motivate') || lowerMessage.includes('encourage') || lowerMessage.includes('stressed')) {
                const motivationalMessages = [
                    "🌟 <strong>You're doing amazing!</strong> Every completed task is a step toward your goals. Keep going!",
                    "💪 <strong>Remember:</strong> Progress, not perfection! You don't have to be perfect, just consistent.",
                    "🎯 <strong>Focus on one task at a time.</strong> You can't do everything at once, and that's perfectly okay!",
                    "🌈 <strong>Take a deep breath.</strong> You've overcome challenges before, and you'll overcome these too!",
                    "⭐ <strong>Celebrate small wins!</strong> Every task you complete is an achievement worth recognizing!",
                    "🚀 <strong>You're stronger than you think!</strong> Look how far you've already come!"
                ];
                
                const randomMessage = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
                return randomMessage;
            }
            
            // Default responses
            const defaultResponses = [
                "🤖 I can help you track your tasks! Try asking me about your task summary, what's due today, or request some productivity tips!",
                "📋 I'm here to help with your tasks! You can ask me about overdue items, high-priority tasks, or your overall progress!",
                "💡 Not sure what to ask? Try: 'How many tasks do I have?', 'What's due today?', or 'Give me productivity tips!'",
                "🎯 I can analyze your task patterns and give you insights! Ask me about your progress or request some motivation!"
            ];
            
            return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
        }

        function startReminderSystem() {
            // Check for reminders every 30 minutes
            reminderInterval = setInterval(() => {
                checkForReminders();
            }, 30 * 60 * 1000);
            
            console.log('🔔 Reminder system started');
        }

        function checkForReminders() {
            const tasks = taskManager.getTasks();
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            const currentHour = now.getHours();
            
            // Check for tasks due today (remind at 9 AM and 2 PM)
            if (currentHour === 9 || currentHour === 14) {
                const todayTasks = tasks.filter(t => t.dueDate === today && !t.completed);
                
                if (todayTasks.length > 0) {
                    showChatNotification();
                    
                    if (!chatbotOpen) {
                        // Add reminder message to chat
                        const timeOfDay = currentHour === 9 ? 'morning' : 'afternoon';
                        const message = `🔔 <strong>Good ${timeOfDay}!</strong> You have ${todayTasks.length} task${todayTasks.length === 1 ? '' : 's'} due today. Would you like me to show them to you?`;
                        addChatMessage(message, 'ai');
                    }
                }
            }
        }

        function checkForOverdueTasks() {
            const tasks = taskManager.getTasks();
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const overdueTasks = tasks.filter(t => {
                if (!t.dueDate || t.completed) return false;
                const dueDate = new Date(t.dueDate);
                dueDate.setHours(0, 0, 0, 0);
                return dueDate < today;
            });
            
            if (overdueTasks.length > 0) {
                showChatNotification();
                
                const message = `⚠️ <strong>Heads up!</strong> You have ${overdueTasks.length} overdue task${overdueTasks.length === 1 ? '' : 's'}. Don't worry - I can help you prioritize and tackle them! 💪`;
                addChatMessage(message, 'ai');
            }
        }

        function showChatNotification() {
            const notification = document.getElementById('chatNotification');
            notification.classList.remove('hidden');
            
            // Auto-hide after 10 seconds if chat is opened
            setTimeout(() => {
                if (chatbotOpen) {
                    notification.classList.add('hidden');
                }
            }, 10000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'975e74c630814710',t:'MTc1NjMyNzk4My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
